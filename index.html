<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>렌탈 견적 계산기</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #f5f5f7;
    }
    .container {
      max-width: 480px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 16px;
      padding: 20px 18px 24px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    }
    h1 {
      font-size: 20px;
      margin: 0 0 16px;
      text-align: center;
    }
    .subtitle {
      font-size: 12px;
      color: #777;
      text-align: center;
      margin-bottom: 18px;
    }
    .field {
      margin-bottom: 14px;
    }
    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
      font-weight: 600;
    }
    /* 숫자/텍스트 입력 공통 스타일 */
    input,
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 14px;
    }
    input:focus,
    select:focus {
      outline: none;
      border-color: #0070f3;
      box-shadow: 0 0 0 2px rgba(0,112,243,0.1);
    }

    .result {
      margin-top: 18px;
      padding: 14px 12px 16px;
      border-radius: 12px;
      background: #f0f4ff;
      font-size: 14px;
    }
    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .pill {
      display: inline-block;
      font-size: 15px;          /* 월 납부액보다 크게 */
      padding: 3px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      font-weight: 700;
    }
    .result-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }
    .result-row span:first-child {
      color: #555;
    }
    .result-row span:last-child {
      font-weight: 600;
    }
    .result-row.strong span {
      font-size: 16px;
      color: #4f46e5; /* 계산 결과 pill과 동일 색상 */
    }
    .discount-detail {
      margin-top: 6px;          /* 총 할인 금액과 살짝 띄움 */
      margin-bottom: 8px;
      font-size: 12px;          /* 기본보다 크게 */
      color: #555;
      line-height: 1.5;
    }
    .discount-detail div {
      margin-top: 2px;
    }
    .hint {
      margin-top: 6px;
      font-size: 11px;
      color: #888;
      line-height: 1.4;
    }
    .hint-line {
      margin-top: 2px;
    }
    .error {
      margin-top: 6px;
      font-size: 12px;
      color: #d32f2f;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>렌탈 견적 계산기</h1>
    <p class="subtitle">월 렌탈료, 약정, 라이프 제휴, 면제 횟수를 기반으로 실납부 총액을 계산합니다.</p>

    <div class="field">
      <label for="monthlyFee">월 렌탈료 (원)</label>
      <input
        id="monthlyFee"
        type="text"
        inputmode="numeric"
        pattern="[0-9]*"
        placeholder="예: 30000"
      />
    </div>

    <div class="field">
      <label for="years">약정 (년)</label>
      <input
        id="years"
        type="text"
        inputmode="numeric"
        pattern="[0-9]*"
        placeholder="예: 5"
      />
    </div>

    <div class="field">
      <label for="lifePlan">라이프 제휴</label>
      <select id="lifePlan">
        <option value="none">미적용</option>
        <option value="599">라이프 599</option>
        <option value="429">라이프 429</option>
      </select>
    </div>

    <div class="field">
      <label for="lifeCount">라이프 구좌 수</label>
      <input
        id="lifeCount"
        type="text"
        inputmode="numeric"
        pattern="[0-9]*"
        placeholder="예: 1 또는 2"
      />
      <div id="errorMsg" class="error"></div>
    </div>

    <div class="field">
      <label for="freeCount">렌탈료 면제 횟수 (회)</label>
      <input
        id="freeCount"
        type="text"
        inputmode="numeric"
        pattern="[0-9]*"
        placeholder="예: 3"
      />
    </div>

    <div class="result">
      <div class="result-header">
        <span class="pill">계산 결과</span>
      </div>

      <div class="result-row">
        <span>월 납부액 (라이프 제휴 적용 후)</span>
        <span id="monthlyAfterLife">-</span>
      </div>
      <div class="result-row">
        <span>렌탈 총액</span>
        <span id="totalRentalText">-</span>
      </div>
      <div class="result-row">
        <span>총 할인 금액</span>
        <span id="totalDiscountText">-</span>
      </div>

      <!-- 총 할인 금액 아래에 할인 설명 배치 -->
      <div class="discount-detail">
        <div id="lifeDetail">라이프 제휴: -</div>
        <div id="freeDetail">렌탈료 면제: -</div>
      </div>

      <div class="result-row strong">
        <span>실납부 총액</span>
        <span id="finalTotalText">-</span>
      </div>

      <div class="hint">
        <div class="hint-line">
          <strong>
            설치월 렌탈료는 설치일자 및 프로모션 조건에 따라 일할 계산·면제 기준이 달라져,
            실제 청구 금액과 본 견적 간에 차이가 발생할 수 있습니다.
          </strong>
        </div>
      </div>
    </div>
  </div>

  <script>
    const monthlyFeeInput = document.getElementById("monthlyFee");
    const yearsInput = document.getElementById("years");
    const lifePlanSelect = document.getElementById("lifePlan");
    const lifeCountInput = document.getElementById("lifeCount");
    const freeCountInput = document.getElementById("freeCount");

    const monthlyAfterLifeText = document.getElementById("monthlyAfterLife");
    const totalRentalText = document.getElementById("totalRentalText");
    const totalDiscountText = document.getElementById("totalDiscountText");
    const finalTotalText = document.getElementById("finalTotalText");

    const lifeDetail = document.getElementById("lifeDetail");
    const freeDetail = document.getElementById("freeDetail");
    const errorMsg = document.getElementById("errorMsg");

    // 라이프 제휴 설정
    // 599: 월 22,500원 × 60회
    // 429: 월 15,000원 × 60회
    const LIFE_CONFIG = {
      "599": { monthly: 22500, times: 60 },
      "429": { monthly: 15000, times: 60 }
    };

    function formatKRW(value) {
      if (isNaN(value)) return "-";
      return value.toLocaleString("ko-KR") + "원";
    }

    function calculate() {
      const monthlyFee = Number((monthlyFeeInput.value || "").replace(/[^0-9]/g, "")) || 0;
      const years = Number((yearsInput.value || "").replace(/[^0-9]/g, "")) || 0;
      const lifePlan = lifePlanSelect.value;
      const freeCount = Number((freeCountInput.value || "").replace(/[^0-9]/g, "")) || 0;
      const lifeCountRawStr = (lifeCountInput.value || "").trim();

      let errorText = "";

      if (!monthlyFee || !years) {
        monthlyAfterLifeText.textContent = "-";
        totalRentalText.textContent = "-";
        totalDiscountText.textContent = "-";
        finalTotalText.textContent = "-";
        lifeDetail.textContent = "라이프 제휴: -";
        freeDetail.textContent = "렌탈료 면제: -";
        errorMsg.textContent = "";
        return;
      }

      // 라이프 적용 여부, 구좌 수 결정
      let appliedLifePlan = lifePlan;
      let appliedLifeCount = 0;

      // 약정 5년 미만이면 라이프 불가
      if (years < 5 && (lifePlan === "599" || lifePlan === "429")) {
        errorText += "약정 5년 미만 상품은 라이프 제휴(599/429)를 이용할 수 없습니다.";
        appliedLifePlan = "none";
        appliedLifeCount = 0;
      } else if (lifePlan === "599" || lifePlan === "429") {
        // 라이프 제휴 선택된 경우에만 구좌 수 체크
        if (lifeCountRawStr === "") {
          // 미입력 시 기본 1구좌로 간주
          appliedLifeCount = 1;
        } else {
          const parsedCount = Number(lifeCountRawStr.replace(/[^0-9]/g, ""));
          if (parsedCount === 1 || parsedCount === 2) {
            appliedLifeCount = parsedCount;
          } else {
            // 1, 2가 아닌 경우: 경고 + 입력값 삭제 + 라이프 미적용
            errorText +=
              (errorText ? "\n" : "") +
              "1개의 제품에는 최대 2구좌까지 라이프 제휴가 가능합니다.";
            lifeCountInput.value = "";
            appliedLifePlan = "none";
            appliedLifeCount = 0;
          }
        }
      }

      // 라이프 제휴 할인 계산
      let lifeMonthlyDiscount = 0;
      let lifeTotalDiscount = 0;
      let lifeDetailText = "라이프 제휴: 미적용";

      if (appliedLifePlan === "599" || appliedLifePlan === "429") {
        const cfg = LIFE_CONFIG[appliedLifePlan];
        lifeMonthlyDiscount = cfg.monthly * appliedLifeCount;

        // 월 렌탈료 vs 라이프 월 할인 합산 검증
        if (monthlyFee <= lifeMonthlyDiscount) {
          const msg =
            `월 렌탈료가 라이프 제휴 월 할인액 합산(${formatKRW(
              lifeMonthlyDiscount
            )}) 이하인 경우 ` + `라이프 제휴를 적용할 수 없습니다.`;
          errorText += (errorText ? "\n" : "") + msg;

          appliedLifePlan = "none";
          appliedLifeCount = 0;
          lifeMonthlyDiscount = 0;
          lifeTotalDiscount = 0;
          lifeDetailText = "라이프 제휴: 미적용";
        } else {
          lifeTotalDiscount = cfg.monthly * cfg.times * appliedLifeCount;
          lifeDetailText =
            `라이프 ${appliedLifePlan} ${appliedLifeCount}구좌 적용: ` +
            `${formatKRW(lifeTotalDiscount)} ` +
            `(${formatKRW(cfg.monthly)} × ${cfg.times}회 × ${appliedLifeCount}구좌)`;
        }
      }

      // 월 납부액 (라이프 제휴 적용 후)
      let monthlyAfterLife = monthlyFee - lifeMonthlyDiscount;
      if (monthlyAfterLife < 0) monthlyAfterLife = 0;

      // 렌탈 총액
      const totalRental = monthlyFee * years * 12;

      // 렌탈료 면제 할인
      let freeDiscount = 0;
      let freeDetailText = "렌탈료 면제: 미적용";
      if (freeCount > 0) {
        freeDiscount = monthlyFee * freeCount;
        freeDetailText =
          `렌탈료 면제: ${formatKRW(freeDiscount)} ` +
          `(${formatKRW(monthlyFee)} × ${freeCount}회)`;
      }

      // 총 할인 금액
      const totalDiscount = lifeTotalDiscount + freeDiscount;

      // 실납부 총액 (음수도 그대로 표시)
      const finalTotal = totalRental - totalDiscount;

      // 화면 표시
      monthlyAfterLifeText.textContent = formatKRW(Math.round(monthlyAfterLife));
      totalRentalText.textContent = formatKRW(Math.round(totalRental));
      totalDiscountText.textContent = formatKRW(Math.round(totalDiscount));
      finalTotalText.textContent = formatKRW(Math.round(finalTotal));

      lifeDetail.textContent = lifeDetailText;
      freeDetail.textContent = freeDetailText;
      errorMsg.textContent = errorText;
    }

    monthlyFeeInput.addEventListener("input", calculate);
    yearsInput.addEventListener("input", calculate);
    lifePlanSelect.addEventListener("change", calculate);
    lifeCountInput.addEventListener("input", calculate);
    freeCountInput.addEventListener("input", calculate);
  </script>
</body>
</html>
